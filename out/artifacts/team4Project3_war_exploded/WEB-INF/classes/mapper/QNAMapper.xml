<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="mapper.QNAMapper">

    <!-- id 속성은 DAO 의 메소드와 같아야 한다. 여기의 boardVO 는 mybatis-confg.xml 에 Alias 되어
        있습니다. -->
    <insert id="create">
        INSERT INTO qna(qnaNo, qnaTitle, qnaContent,
                        nickname, category, qnaDate)
        values (qna_ID.nextval, #{qnaTitle}, #{qnaContent}, #{nickname},
                #{category}, sysdate)
    </insert>

    <update id="update">
        update qna
        set qnaTitle   = #{qnaTitle},
            qnaContent = #{qnaContent},
            category   = #{category}
        where qnaNo = #{qnaNo}
    </update>

    <delete id="delete">
        delete
        from qna
        where qnaNo = #{qnaNo}
    </delete>

    <select id="read" resultType="domain.QNAVO">
        select qnaNo,
               qnaTitle,
               qnaContent,
               nickname,
               category,
               qnaDate,
               answerContent

        from qna
        where qnaNo = #{qnaNo}
    </select>

    <select id="listAll" resultType="domain.NoticeVO">
<![CDATA[
        select qnaNo,
               qnaTitle,
               qnaDate
        from qna
        order by qnaNo desc
        ]]>
	</select>

    <select id="listCount" resultType="int">
		<![CDATA[
        select count(qnaNo)
        from qna
        where qnaNo > 0
        ]]>
	</select>

    <select id="listQNA" parameterType="domain.Criteria" resultType="domain.QNAVO">
        SELECT qnaNo,
               category,
               qnaTitle,
               nickname,
               qnaDate
        FROM (SELECT qnaNo,
                     category,
                     qnaTitle,
                     nickname,
                     qnaDate,
                     ROW_NUMBER() OVER(ORDER BY qnaNo DESC) AS RNUM
              FROM qna)
        WHERE RNUM BETWEEN #{rowStart} AND #{rowEnd}
        ORDER BY qnaNo DESC
    </select>


    <!--
    <select id="idCheck" resultType="int">
            select count(*) from member
            where id = #{id}
        </select>
        -->
    <!--
        <select id="listPage" resultType="NoticeVO">
    <![CDATA[
    select
     noticeNo, noticeTitle, regDate
    from
     notice
    where noticeNo > 0
    order by noticeNo desc, regDate desc
    limit #{page}, 10
    ]]>
        </select>

        <select id="listCriteria" resultType="NoticeVO">
    <![CDATA[
    select
     noticeNo, noticeTitle, noticeContent, nickname, regDate
    from  notice
    where noticeNo > 0
    order by noticeNo desc, regDate desc
    limit #{pageStart}, #{perPageNum}
    ]]>
        </select>

        <select id="countPaging" resultType="int">
    <![CDATA[
    select
     count(noticeNo)
    from
     notice
    where
     noticeNo > 0
    ]]>
        </select>

        <sql id="search">
            <if test="searchType != null">
                <if test="searchType == 't'.toString()">
                    and noticeTitle like CONCAT('%', #{keyword}, '%')
                </if>
                <if test="searchType == 'c'.toString()">
                    and noticeContent like CONCAT('%', #{keyword}, '%')
                </if>
                <if test="searchType == 'w'.toString()">
                    and nickname like CONCAT('%', #{keyword}, '%')
                </if>
                <if test="searchType == 'tc'.toString()">
                    and ( noticeTitle like CONCAT('%', #{keyword}, '%') OR noticeContent like
                    CONCAT('%', #{keyword}, '%'))
                </if>
                <if test="searchType == 'cw'.toString()">
                    and ( noticeContent like CONCAT('%', #{keyword}, '%') OR nickname like
                    CONCAT('%', #{keyword}, '%'))
                </if>
                <if test="searchType == 'tcw'.toString()">
                    and ( noticeTitle like CONCAT('%', #{keyword}, '%')
                    OR
                    noticeContent like CONCAT('%', #{keyword}, '%')
                    OR
                    nickname like CONCAT('%', #{keyword}, '%'))
                </if>
            </if>
        </sql>

        <select id="listSearch" resultType="BoardVO">
    <![CDATA[
     select *
     from notice
     where noticeNo > 0
    ]]>

            <include refid="search"></include>

    <![CDATA[
     order by noticeNo desc
     limit #{pageStart}, #{perPageNum}
    ]]>
        </select>

        <select id="listSearchCount" resultType="int">
    <![CDATA[
     select count(noticeNo)
     from notice
     where noticeNo > 0
    ]]>
            <include refid="search"></include>
        </select>-->

</mapper>
